from sys import executable
from subprocess import Popen


def self_destruct():
    """
    Self-destructs running executable via supplemental batch file,
    cause executable cannot kill itself.
    """
    executable_name = executable.split("\\")[-1]

    batch_script_content = "\n".join([
        "@echo off",                              # disabling echo of commands that are executed
        'TASKKILL /F /IM "{0}"'.format(executable_name),  # forcefully kill the process
        "TIMEOUT 1",  # waiting for the process to shutdown
        'DEL -f "{0}"'.format(executable_name),  # forcefully deleting executable
        'DEL "%~f0"',                            # deleting batch file
    ])
    batch_script = open("utility.bat", "w")
    batch_script.write(batch_script_content)
    batch_script.close()

    Popen("utility.bat >> NUL", shell=True)  # NUL to hide output
